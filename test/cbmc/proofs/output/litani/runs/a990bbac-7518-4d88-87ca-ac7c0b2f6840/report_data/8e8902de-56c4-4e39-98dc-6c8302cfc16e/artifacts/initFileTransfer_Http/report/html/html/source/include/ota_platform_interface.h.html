
<html>
<head>
<title>source/include/ota_platform_interface.h</title>
<link rel="stylesheet" type="text/css" href="../../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * AWS IoT Over-the-air Update v3.0.0</div><div id="3" class="line none">    3  * Copyright (C) 2020 Amazon.com, Inc. or its affiliates.  All Rights Reserved.</div><div id="4" class="line none">    4  *</div><div id="5" class="line none">    5  * Permission is hereby granted, free of charge, to any person obtaining a copy of</div><div id="6" class="line none">    6  * this software and associated documentation files (the "Software"), to deal in</div><div id="7" class="line none">    7  * the Software without restriction, including without limitation the rights to</div><div id="8" class="line none">    8  * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of</div><div id="9" class="line none">    9  * the Software, and to permit persons to whom the Software is furnished to do so,</div><div id="10" class="line none">   10  * subject to the following conditions:</div><div id="11" class="line none">   11  *</div><div id="12" class="line none">   12  * The above copyright notice and this permission notice shall be included in all</div><div id="13" class="line none">   13  * copies or substantial portions of the Software.</div><div id="14" class="line none">   14  *</div><div id="15" class="line none">   15  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</div><div id="16" class="line none">   16  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS</div><div id="17" class="line none">   17  * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR</div><div id="18" class="line none">   18  * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</div><div id="19" class="line none">   19  * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</div><div id="20" class="line none">   20  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</div><div id="21" class="line none">   21  */</div><div id="22" class="line none">   22 </div><div id="23" class="line none">   23 /**</div><div id="24" class="line none">   24  * @file ota_platform_interface.h</div><div id="25" class="line none">   25  * @brief Contains PAL interface statuses, type definitions and structure to store interface routines.</div><div id="26" class="line none">   26  */</div><div id="27" class="line none">   27 </div><div id="28" class="line none">   28 #ifndef <a href="ota_platform_interface.h.html#29">OTA_PLATFORM_INTERFACE</a></div><div id="29" class="line none">   29 #define <a href="ota_platform_interface.h.html#29">OTA_PLATFORM_INTERFACE</a></div><div id="30" class="line none">   30 </div><div id="31" class="line none">   31 #include "ota_private.h"</div><div id="32" class="line none">   32 </div><div id="33" class="line none">   33 /**</div><div id="34" class="line none">   34  * @otapalpage</div><div id="35" class="line none">   35  * @brief The OTA PAL interface definition.</div><div id="36" class="line none">   36  *</div><div id="37" class="line none">   37  * @otapalsectionoverview</div><div id="38" class="line none">   38  *</div><div id="39" class="line none">   39  * The OTA PAL interface is a set of APIs that must be implemented for the</div><div id="40" class="line none">   40  * device using the OTA library. These device specific implementation for the</div><div id="41" class="line none">   41  * OTA PAL is provided to the library in the user application. These functions</div><div id="42" class="line none">   42  * are used by the library to store, manage, and authenticate downloads.</div><div id="43" class="line none">   43  *</div><div id="44" class="line none">   44  * The OTA PAL interface is defined in @ref ota_platform_interface.h.</div><div id="45" class="line none">   45  * &lt;br&gt;</div><div id="46" class="line none">   46  *</div><div id="47" class="line none">   47  * The functions that must be implemented are:&lt;br&gt;</div><div id="48" class="line none">   48  * - [OTA PAL Abort](@ref OtaPalAbort_t)</div><div id="49" class="line none">   49  * - [OTA PAL Create File](@ref OtaPalCreateFileForRx_t)</div><div id="50" class="line none">   50  * - [OTA PAL Close File](@ref OtaPalCloseFile_t)</div><div id="51" class="line none">   51  * - [OTA PAL Write Block](@ref OtaPalWriteBlock_t)</div><div id="52" class="line none">   52  * - [OTA PAL Activate New Image](@ref OtaPalActivateNewImage_t)</div><div id="53" class="line none">   53  * - [OTA PAL Reset Device](@ref OtaPalResetDevice_t)</div><div id="54" class="line none">   54  * - [OTA PAL Set Platform Image State](@ref OtaPalSetPlatformImageState_t)</div><div id="55" class="line none">   55  * - [OTA PAL Get Platform Image State](@ref OtaPalGetPlatformImageState_t)</div><div id="56" class="line none">   56  */</div><div id="57" class="line none">   57 </div><div id="58" class="line none">   58 /**</div><div id="59" class="line none">   59  * @brief The OTA platform interface return status. Composed of main and sub status.</div><div id="60" class="line none">   60  */</div><div id="61" class="line none">   61 typedef uint32_t   <a href="ota_platform_interface.h.html#61">OtaPalStatus_t</a>;</div><div id="62" class="line none">   62 </div><div id="63" class="line none">   63 /**</div><div id="64" class="line none">   64  * @brief The OTA platform interface sub status.</div><div id="65" class="line none">   65  */</div><div id="66" class="line none">   66 typedef uint32_t   <a href="ota_platform_interface.h.html#66">OtaPalSubStatus_t</a>;</div><div id="67" class="line none">   67 </div><div id="68" class="line none">   68 /**</div><div id="69" class="line none">   69  * @ingroup ota_enum_types</div><div id="70" class="line none">   70  * @brief The OTA platform interface main status.</div><div id="71" class="line none">   71  */</div><div id="72" class="line none">   72 typedef enum <a href="ota_platform_interface.h.html#72">OtaPalMainStatus</a></div><div id="73" class="line none">   73 {</div><div id="74" class="line none">   74     <a href="ota_platform_interface.h.html#74">OtaPalSuccess</a> = 0,          /*!&lt; @brief OTA platform interface success. */</div><div id="75" class="line none">   75     <a href="ota_platform_interface.h.html#75">OtaPalUninitialized</a> = 0xe0, /*!&lt; @brief Result is not yet initialized from PAL. */</div><div id="76" class="line none">   76     <a href="ota_platform_interface.h.html#76">OtaPalOutOfMemory</a>,          /*!&lt; @brief Out of memory. */</div><div id="77" class="line none">   77     <a href="ota_platform_interface.h.html#77">OtaPalNullFileContext</a>,      /*!&lt; @brief The PAL is called with a NULL file context. */</div><div id="78" class="line none">   78     <a href="ota_platform_interface.h.html#78">OtaPalSignatureCheckFailed</a>, /*!&lt; @brief The signature check failed for the specified file. */</div><div id="79" class="line none">   79     <a href="ota_platform_interface.h.html#79">OtaPalRxFileCreateFailed</a>,   /*!&lt; @brief The PAL failed to create the OTA receive file. */</div><div id="80" class="line none">   80     <a href="ota_platform_interface.h.html#80">OtaPalRxFileTooLarge</a>,       /*!&lt; @brief The OTA receive file is too big for the platform to support. */</div><div id="81" class="line none">   81     <a href="ota_platform_interface.h.html#81">OtaPalBootInfoCreateFailed</a>, /*!&lt; @brief The PAL failed to create the OTA boot info file. */</div><div id="82" class="line none">   82     <a href="ota_platform_interface.h.html#82">OtaPalBadSignerCert</a>,        /*!&lt; @brief The signer certificate was not readable or zero length. */</div><div id="83" class="line none">   83     <a href="ota_platform_interface.h.html#83">OtaPalBadImageState</a>,        /*!&lt; @brief The specified OTA image state was out of range. */</div><div id="84" class="line none">   84     <a href="ota_platform_interface.h.html#84">OtaPalAbortFailed</a>,          /*!&lt; @brief Error trying to abort the OTA. */</div><div id="85" class="line none">   85     <a href="ota_platform_interface.h.html#85">OtaPalRejectFailed</a>,         /*!&lt; @brief Error trying to reject the OTA image. */</div><div id="86" class="line none">   86     <a href="ota_platform_interface.h.html#86">OtaPalCommitFailed</a>,         /*!&lt; @brief The acceptance commit of the new OTA image failed. */</div><div id="87" class="line none">   87     <a href="ota_platform_interface.h.html#87">OtaPalActivateFailed</a>,       /*!&lt; @brief The activation of the new OTA image failed. */</div><div id="88" class="line none">   88     <a href="ota_platform_interface.h.html#88">OtaPalFileAbort</a>,            /*!&lt; @brief Error in low level file abort. */</div><div id="89" class="line none">   89     <a href="ota_platform_interface.h.html#89">OtaPalFileClose</a>             /*!&lt; @brief Error in low level file close. */</div><div id="90" class="line none">   90 } <a href="ota_platform_interface.h.html#90">OtaPalMainStatus_t</a>;</div><div id="91" class="line none">   91 </div><div id="92" class="line none">   92 /**</div><div id="93" class="line none">   93  * @constantspage{ota,OTA library}</div><div id="94" class="line none">   94  *</div><div id="95" class="line none">   95  * @section ota_constants_err_code_helpers OTA Error Code Helper constants</div><div id="96" class="line none">   96  * @brief OTA PAL Error code helper for extracting the error code from the OTA PAL.</div><div id="97" class="line none">   97  *</div><div id="98" class="line none">   98  * @snippet this define_ota_err_code_helpers</div><div id="99" class="line none">   99  *</div><div id="100" class="line none">  100  * OTA pal error codes consist of an main code in the upper 8 bits of a 32 bit word and sometimes</div><div id="101" class="line none">  101  * merged with a platform specific code in the lower 24 bits. You must refer to the platform PAL</div><div id="102" class="line none">  102  * layer in use to determine the meaning of the lower 24 bits.</div><div id="103" class="line none">  103  */</div><div id="104" class="line none">  104 </div><div id="105" class="line none">  105 /* @[define_ota_err_code_helpers] */</div><div id="106" class="line none">  106 #define <a href="ota_platform_interface.h.html#106">OTA_PAL_ERR_MASK</a>    0xffffffUL                                                                                                           /*!&lt; The PAL layer uses the signed low 24 bits of the OTA error code. */</div><div id="107" class="line none">  107 #define <a href="ota_platform_interface.h.html#107">OTA_PAL_SUB_BITS</a>    24U                                                                                                                  /*!&lt; The OTA Agent error code is the highest 8 bits of the word. */</div><div id="108" class="line none">  108 #define <a href="ota_platform_interface.h.html#108">OTA_PAL_MAIN_ERR</a>( err )             ( ( <a href="ota_platform_interface.h.html#90">OtaPalMainStatus_t</a> ) ( uint32_t ) ( ( uint32_t ) ( err ) &gt;&gt; ( uint32_t ) <a href="ota_platform_interface.h.html#107">OTA_PAL_SUB_BITS</a> ) )    /*!&lt; Helper to get the OTA PAL main error code. */</div><div id="109" class="line none">  109 #define <a href="ota_platform_interface.h.html#109">OTA_PAL_SUB_ERR</a>( err )              ( ( uint32_t ) ( err ) &amp; ( uint32_t ) <a href="ota_platform_interface.h.html#106">OTA_PAL_ERR_MASK</a> )                                             /*!&lt; Helper to get the OTA PAL sub error code. */</div><div id="110" class="line none">  110 #define <a href="ota_platform_interface.h.html#110">OTA_PAL_COMBINE_ERR</a>( main, sub )    ( ( ( uint32_t ) ( main ) &lt;&lt; ( uint32_t ) <a href="ota_platform_interface.h.html#107">OTA_PAL_SUB_BITS</a> ) | ( uint32_t ) <a href="ota_platform_interface.h.html#109">OTA_PAL_SUB_ERR</a>( sub ) ) /*!&lt; Helper to combine the OTA PAL main and sub error code. */</div><div id="111" class="line none">  111 /* @[define_ota_err_code_helpers] */</div><div id="112" class="line none">  112 </div><div id="113" class="line none">  113 /**</div><div id="114" class="line none">  114  * @brief Abort an OTA transfer.</div><div id="115" class="line none">  115  *</div><div id="116" class="line none">  116  * Aborts access to an existing open file represented by the OTA file context pFileContext. This is</div><div id="117" class="line none">  117  * only valid for jobs that started successfully.</div><div id="118" class="line none">  118  *</div><div id="119" class="line none">  119  * @note The input OtaFileContext_t pFileContext is checked for NULL by the OTA agent before this</div><div id="120" class="line none">  120  * function is called.</div><div id="121" class="line none">  121  * This function may be called before the file is opened, so the file pointer pFileContext-&gt;fileHandle</div><div id="122" class="line none">  122  * may be NULL when this function is called.</div><div id="123" class="line none">  123  *</div><div id="124" class="line none">  124  * @param[in] pFileContext OTA file context information.</div><div id="125" class="line none">  125  *</div><div id="126" class="line none">  126  * @return The OTA PAL layer error code combined with the MCU specific error code. See OTA Agent</div><div id="127" class="line none">  127  * error codes information in ota.h.</div><div id="128" class="line none">  128  *</div><div id="129" class="line none">  129  * The file pointer will be set to NULL after this function returns.</div><div id="130" class="line none">  130  * OtaPalSuccess is returned when aborting access to the open file was successful.</div><div id="131" class="line none">  131  * OtaPalFileAbort is returned when aborting access to the open file context was unsuccessful.</div><div id="132" class="line none">  132  */</div><div id="133" class="line none">  133 typedef <a href="ota_platform_interface.h.html#61">OtaPalStatus_t</a> ( * <a href="ota_platform_interface.h.html#133">OtaPalAbort_t</a> )( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext );</div><div id="134" class="line none">  134 </div><div id="135" class="line none">  135 /**</div><div id="136" class="line none">  136  * @brief Create a new receive file for the data chunks as they come in.</div><div id="137" class="line none">  137  *</div><div id="138" class="line none">  138  * @note Opens the file indicated in the OTA file context in the MCU file system.</div><div id="139" class="line none">  139  *</div><div id="140" class="line none">  140  * @note The previous image may be present in the designated image download partition or file, so the</div><div id="141" class="line none">  141  * partition or file must be completely erased or overwritten in this routine.</div><div id="142" class="line none">  142  *</div><div id="143" class="line none">  143  * @note The input OtaFileContext_t pFileContext is checked for NULL by the OTA agent before this</div><div id="144" class="line none">  144  * function is called.</div><div id="145" class="line none">  145  * The device file path is a required field in the OTA job document, so pFileContext-&gt;pFilePath is</div><div id="146" class="line none">  146  * checked for NULL by the OTA agent before this function is called.</div><div id="147" class="line none">  147  *</div><div id="148" class="line none">  148  * @param[in] pFileContext OTA file context information.</div><div id="149" class="line none">  149  *</div><div id="150" class="line none">  150  * @return The OTA PAL layer error code combined with the MCU specific error code. See OTA Agent</div><div id="151" class="line none">  151  * error codes information in ota.h.</div><div id="152" class="line none">  152  *</div><div id="153" class="line none">  153  * OtaPalSuccess is returned when file creation is successful.</div><div id="154" class="line none">  154  * OtaPalRxFileTooLarge is returned if the file to be created exceeds the device's non-volatile memory size constraints.</div><div id="155" class="line none">  155  * OtaPalBootInfoCreateFailed is returned if the bootloader information file creation fails.</div><div id="156" class="line none">  156  * OtaPalRxFileCreateFailed is returned for other errors creating the file in the device's non-volatile memory.</div><div id="157" class="line none">  157  */</div><div id="158" class="line none">  158 typedef <a href="ota_platform_interface.h.html#61">OtaPalStatus_t</a> (* <a href="ota_platform_interface.h.html#158">OtaPalCreateFileForRx_t</a>)( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext );</div><div id="159" class="line none">  159 </div><div id="160" class="line none">  160 /**</div><div id="161" class="line none">  161  * @brief Authenticate and close the underlying receive file in the specified OTA context.</div><div id="162" class="line none">  162  *</div><div id="163" class="line none">  163  * @note The input OtaFileContext_t pFileContext is checked for NULL by the OTA agent before this</div><div id="164" class="line none">  164  * function is called. This function is called only at the end of block ingestion.</div><div id="165" class="line none">  165  * prvPAL_CreateFileForRx() must succeed before this function is reached, so</div><div id="166" class="line none">  166  * pFileContext-&gt;fileHandle(or pFileContext-&gt;pFile) is never NULL.</div><div id="167" class="line none">  167  * The certificate path on the device is a required job document field in the OTA Agent,</div><div id="168" class="line none">  168  * so pFileContext-&gt;pCertFilepath is never NULL.</div><div id="169" class="line none">  169  * The file signature key is required job document field in the OTA Agent, so pFileContext-&gt;pSignature will</div><div id="170" class="line none">  170  * never be NULL.</div><div id="171" class="line none">  171  *</div><div id="172" class="line none">  172  * If the signature verification fails, file close should still be attempted.</div><div id="173" class="line none">  173  *</div><div id="174" class="line none">  174  * @param[in] pFileContext OTA file context information.</div><div id="175" class="line none">  175  *</div><div id="176" class="line none">  176  * @return The OTA PAL layer error code combined with the MCU specific error code. See OTA Agent</div><div id="177" class="line none">  177  * error codes information in ota.h.</div><div id="178" class="line none">  178  *</div><div id="179" class="line none">  179  * OtaPalSuccess is returned on success.</div><div id="180" class="line none">  180  * OtaPalSignatureCheckFailed is returned when cryptographic signature verification fails.</div><div id="181" class="line none">  181  * OtaPalBadSignerCert is returned for errors in the certificate itself.</div><div id="182" class="line none">  182  * OtaPalFileClose is returned when closing the file fails.</div><div id="183" class="line none">  183  */</div><div id="184" class="line none">  184 typedef <a href="ota_platform_interface.h.html#61">OtaPalStatus_t</a> ( * <a href="ota_platform_interface.h.html#184">OtaPalCloseFile_t</a> )( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext );</div><div id="185" class="line none">  185 </div><div id="186" class="line none">  186 /**</div><div id="187" class="line none">  187  * @brief Write a block of data to the specified file at the given offset.</div><div id="188" class="line none">  188  *</div><div id="189" class="line none">  189  * @note The input OtaFileContext_t pFileContext is checked for NULL by the OTA agent before this</div><div id="190" class="line none">  190  * function is called.</div><div id="191" class="line none">  191  * The file pointer/handle pFileContext-&gt;pFile, is checked for NULL by the OTA agent before this</div><div id="192" class="line none">  192  * function is called.</div><div id="193" class="line none">  193  * pData is checked for NULL by the OTA agent before this function is called.</div><div id="194" class="line none">  194  * blockSize is validated for range by the OTA agent before this function is called.</div><div id="195" class="line none">  195  * offset is validated by the OTA agent before this function is called.</div><div id="196" class="line none">  196  *</div><div id="197" class="line none">  197  * @param[in] pFileContext OTA file context information.</div><div id="198" class="line none">  198  * @param[in] offset Byte offset to write to from the beginning of the file.</div><div id="199" class="line none">  199  * @param[in] pData Pointer to the byte array of data to write.</div><div id="200" class="line none">  200  * @param[in] blockSize The number of bytes to write.</div><div id="201" class="line none">  201  *</div><div id="202" class="line none">  202  * @return The number of bytes written on a success, or a negative error code from the platform</div><div id="203" class="line none">  203  * abstraction layer.</div><div id="204" class="line none">  204  */</div><div id="205" class="line none">  205 typedef int16_t ( * <a href="ota_platform_interface.h.html#205">OtaPalWriteBlock_t</a> ) ( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext,</div><div id="206" class="line none">  206                                            uint32_t offset,</div><div id="207" class="line none">  207                                            uint8_t * const pData,</div><div id="208" class="line none">  208                                            uint32_t blockSize );</div><div id="209" class="line none">  209 </div><div id="210" class="line none">  210 /**</div><div id="211" class="line none">  211  * @brief Activate the newest MCU image received via OTA.</div><div id="212" class="line none">  212  *</div><div id="213" class="line none">  213  * This function shall do whatever is necessary to activate the newest MCU</div><div id="214" class="line none">  214  * firmware received via OTA. It is typically just a reset of the device.</div><div id="215" class="line none">  215  *</div><div id="216" class="line none">  216  * @note This function SHOULD not return. If it does, the platform does not support</div><div id="217" class="line none">  217  * an automatic reset or an error occurred.</div><div id="218" class="line none">  218  *</div><div id="219" class="line none">  219  * @return The OTA PAL layer error code combined with the MCU specific error code. See OTA Agent</div><div id="220" class="line none">  220  * error codes information in ota.h.</div><div id="221" class="line none">  221  */</div><div id="222" class="line none">  222 typedef <a href="ota_platform_interface.h.html#61">OtaPalStatus_t</a> ( * <a href="ota_platform_interface.h.html#222">OtaPalActivateNewImage_t</a> )( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext );</div><div id="223" class="line none">  223 </div><div id="224" class="line none">  224 /**</div><div id="225" class="line none">  225  * @brief Reset the device.</div><div id="226" class="line none">  226  *</div><div id="227" class="line none">  227  * This function shall reset the MCU and cause a reboot of the system.</div><div id="228" class="line none">  228  *</div><div id="229" class="line none">  229  * @note This function SHOULD not return. If it does, the platform does not support</div><div id="230" class="line none">  230  * an automatic reset or an error occurred.</div><div id="231" class="line none">  231  *</div><div id="232" class="line none">  232  * @return The OTA PAL layer error code combined with the MCU specific error code. See OTA Agent</div><div id="233" class="line none">  233  * error codes information in ota.h.</div><div id="234" class="line none">  234  */</div><div id="235" class="line none">  235 </div><div id="236" class="line none">  236 typedef <a href="ota_platform_interface.h.html#61">OtaPalStatus_t</a> ( * <a href="ota_platform_interface.h.html#236">OtaPalResetDevice_t</a> ) ( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext );</div><div id="237" class="line none">  237 </div><div id="238" class="line none">  238 /**</div><div id="239" class="line none">  239  * @brief Attempt to set the state of the OTA update image.</div><div id="240" class="line none">  240  *</div><div id="241" class="line none">  241  * Do whatever is required by the platform to Accept/Reject the OTA update image (or bundle).</div><div id="242" class="line none">  242  * Refer to the PAL implementation to determine what happens on your platform.</div><div id="243" class="line none">  243  *</div><div id="244" class="line none">  244  * @param[in] pFileContext File context of type OtaFileContext_t.</div><div id="245" class="line none">  245  *</div><div id="246" class="line none">  246  * @param[in] eState The desired state of the OTA update image.</div><div id="247" class="line none">  247  *</div><div id="248" class="line none">  248  * @return The OtaPalStatus_t error code combined with the MCU specific error code. See ota.h for</div><div id="249" class="line none">  249  *         OTA major error codes and your specific PAL implementation for the sub error code.</div><div id="250" class="line none">  250  *</div><div id="251" class="line none">  251  * Major error codes returned are:</div><div id="252" class="line none">  252  *</div><div id="253" class="line none">  253  *   OtaPalSuccess on success.</div><div id="254" class="line none">  254  *   OtaPalBadImageState: if you specify an invalid OtaImageState_t. No sub error code.</div><div id="255" class="line none">  255  *   OtaPalAbortFailed: failed to roll back the update image as requested by OtaImageStateAborted.</div><div id="256" class="line none">  256  *   OtaPalRejectFailed: failed to roll back the update image as requested by OtaImageStateRejected.</div><div id="257" class="line none">  257  *   OtaPalCommitFailed: failed to make the update image permanent as requested by OtaImageStateAccepted.</div><div id="258" class="line none">  258  */</div><div id="259" class="line none">  259 typedef <a href="ota_platform_interface.h.html#61">OtaPalStatus_t</a> ( * <a href="ota_platform_interface.h.html#259">OtaPalSetPlatformImageState_t</a> )( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext,</div><div id="260" class="line none">  260                                                             <a href="ota_private.h.html#316">OtaImageState_t</a> eState );</div><div id="261" class="line none">  261 </div><div id="262" class="line none">  262 /**</div><div id="263" class="line none">  263  * @brief Get the state of the OTA update image.</div><div id="264" class="line none">  264  *</div><div id="265" class="line none">  265  * We read this at OTA_Init time and when the latest OTA job reports itself in self</div><div id="266" class="line none">  266  * test. If the update image is in the "pending commit" state, we start a self test</div><div id="267" class="line none">  267  * timer to assure that we can successfully connect to the OTA services and accept</div><div id="268" class="line none">  268  * the OTA update image within a reasonable amount of time (user configurable). If</div><div id="269" class="line none">  269  * we don't satisfy that requirement, we assume there is something wrong with the</div><div id="270" class="line none">  270  * firmware and automatically reset the device, causing it to roll back to the</div><div id="271" class="line none">  271  * previously known working code.</div><div id="272" class="line none">  272  *</div><div id="273" class="line none">  273  * If the update image state is not in "pending commit," the self test timer is</div><div id="274" class="line none">  274  * not started.</div><div id="275" class="line none">  275  *</div><div id="276" class="line none">  276  * @param[in] pFileContext File context of type OtaFileContext_t.</div><div id="277" class="line none">  277  *</div><div id="278" class="line none">  278  * @return An OtaPalImageState_t. One of the following:</div><div id="279" class="line none">  279  *   OtaPalImageStatePendingCommit (the new firmware image is in the self test phase)</div><div id="280" class="line none">  280  *   OtaPalImageStateValid         (the new firmware image is already committed)</div><div id="281" class="line none">  281  *   OtaPalImageStateInvalid       (the new firmware image is invalid or non-existent)</div><div id="282" class="line none">  282  *</div><div id="283" class="line none">  283  *   NOTE: OtaPalImageStateUnknown should NEVER be returned and indicates an implementation error.</div><div id="284" class="line none">  284  */</div><div id="285" class="line none">  285 typedef <a href="ota_private.h.html#330">OtaPalImageState_t</a> ( * <a href="ota_platform_interface.h.html#285">OtaPalGetPlatformImageState_t</a> ) ( <a href="ota_private.h.html#408">OtaFileContext_t</a> * const pFileContext );</div><div id="286" class="line none">  286 </div><div id="287" class="line none">  287 /**</div><div id="288" class="line none">  288  * @ingroup ota_struct_types</div><div id="289" class="line none">  289  * @brief OTA pal Interface structure.</div><div id="290" class="line none">  290  */</div><div id="291" class="line none">  291 typedef struct <a href="ota_platform_interface.h.html#291">OtaPalInterface</a></div><div id="292" class="line none">  292 {</div><div id="293" class="line none">  293     /* MISRA rule 21.8 prohibits the use of abort from stdlib.h. However, this is merely one of the</div><div id="294" class="line none">  294      * OTA platform abstraction layer interfaces, which is used to abort an OTA update. So it's a</div><div id="295" class="line none">  295      * false positive. */</div><div id="296" class="line none">  296     /* coverity[misra_c_2012_rule_21_8_violation] */</div><div id="297" class="line none">  297     <a href="ota_platform_interface.h.html#133">OtaPalAbort_t</a> <a href="ota_platform_interface.h.html#297">abort</a>;                                 /*!&lt; @brief Abort an OTA transfer. */</div><div id="298" class="line none">  298     <a href="ota_platform_interface.h.html#158">OtaPalCreateFileForRx_t</a> <a href="ota_platform_interface.h.html#298">createFile</a>;                  /*!&lt; @brief Create a new receive file. */</div><div id="299" class="line none">  299     <a href="ota_platform_interface.h.html#184">OtaPalCloseFile_t</a> <a href="ota_platform_interface.h.html#299">closeFile</a>;                         /*!&lt; @brief Authenticate and close the receive file. */</div><div id="300" class="line none">  300     <a href="ota_platform_interface.h.html#205">OtaPalWriteBlock_t</a> <a href="ota_platform_interface.h.html#300">writeBlock</a>;                       /*!&lt; @brief Write a block of data to the specified file at the given offset. */</div><div id="301" class="line none">  301     <a href="ota_platform_interface.h.html#222">OtaPalActivateNewImage_t</a> <a href="ota_platform_interface.h.html#301">activate</a>;                   /*!&lt; @brief Activate the file received over-the-air. */</div><div id="302" class="line none">  302     <a href="ota_platform_interface.h.html#236">OtaPalResetDevice_t</a> <a href="ota_platform_interface.h.html#302">reset</a>;                           /*!&lt; @brief Reset the device. */</div><div id="303" class="line none">  303     <a href="ota_platform_interface.h.html#259">OtaPalSetPlatformImageState_t</a> <a href="ota_platform_interface.h.html#303">setPlatformImageState</a>; /*!&lt; @brief Set the state of the OTA update image. */</div><div id="304" class="line none">  304     <a href="ota_platform_interface.h.html#285">OtaPalGetPlatformImageState_t</a> <a href="ota_platform_interface.h.html#304">getPlatformImageState</a>; /*!&lt; @brief Get the state of the OTA update image. */</div><div id="305" class="line none">  305 } <a href="ota_platform_interface.h.html#305">OtaPalInterface_t</a>;</div><div id="306" class="line none">  306 </div><div id="307" class="line none">  307 #endif /* ifndef OTA_PLATFORM_INTERFACE */</div>
</div>
</body>
</html>
